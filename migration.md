# 既存のサービスを異なる言語で書き直したい「マイグレーション」

## 背景

技術的にモダンな言語、フレームワーク（Next.js、Goなど）が日々登場し、既存のサービスをモダンな言語にシフトする（**マイグレーション**）という事例が増えている。

早い段階で**マイグレーション**しないと、後継者不足（古い言語に対応できない）となったり、開発効率が落ちたり、パフォーマンスの陳腐化が目立ったりする。

参考記事：https://service.shiftinc.jp/column/4677/

## 現状

- しかしながら、莫大な時間がかかる
- 10年、20年続いているサービスは、なかなかそれができない
- 銀行システムなど重要システムは、COBOLで動作している

> [!TIP]
> というのを会社の説明会で聞きましたとさ

## マイグレーションのやり方

1. **現在のコードベースの理解**
2. 新しい言語の学習
3. API仕様の設計
4. コードの書き換え
5. テストとデバッグ
6. デプロイと監視

<details>
<summary>ChatGPTにて</summary>

言語を書き直して移行するプロセスは、以下の一般的なステップで行うことができます。

1. **現在のコードベースの理解**: まず、Next.jsで作成された既存のAPI機能について理解することから始めます。これには、エンドポイント、データモデル、ビジネスロジック、認証/認可などの機能の把握が含まれます。
2. **新しい言語の学習**: 移行先の言語であるRailsを学習します。これには、言語の構文、フレームワークの機能、ベストプラクティスなどを理解することが含まれます。
3. **API仕様の設計**: 新しい言語でのAPIの仕様を設計します。これには、エンドポイントの定義、リクエスト/レスポンスの形式、認証方法などが含まれます。この段階で、OpenAPIなどの仕様定義ツールを活用すると便利です。
4. **コードの書き換え**: 既存のNext.jsのコードをRailsのコードに書き換えます。これには、エンドポイントの実装、データモデルの作成、ビジネスロジックの移植などが含まれます。
5. **テストとデバッグ**: 新しいコードをテストし、動作を確認します。これには、ユニットテスト、統合テスト、エンドツーエンドテストなどが含まれます。また、テストやデバッグを行いながら必要に応じて修正を加えます。
6. **デプロイと監視**: 新しいコードをデプロイし、実稼働環境で動作させます。そして、システムの監視を行い、必要に応じてパフォーマンスの最適化やバグ修正を行います。
7. **文書化とトレーニング**: 新しいAPIの仕様やコードに関する文書を作成し、関係者に提供します。また、必要に応じてチームメンバーに新しい技術やベストプラクティスをトレーニングします。

このようなステップを踏むことで、言語の書き換えと移行プロセスを効果的に管理し、スムーズな移行を実現することができます。

</details>

### 現在のコードベースの理解が必要

1. **ドキュメントの不備や古さ**：特にアジャイル開発の場合、コードがドキュメントよりも先に進化してしまう
2. **移行先の言語やフレームワークに特有の概念の理解**: 移行先の言語やフレームワークには、独自の概念やパターンが存在するため、臨機応変に対応する必要がある
3. 立案者・PdM的な後継者が既にいない場合もある

### ターゲットユーザ

- 過去のシステムの概要は何となくわかっている人
    - 例）銀行のシステム、ユーザログイン機能や振込、閲覧機能などがあるな〜程度
- ただし、それまでコード側はノータッチで、特に古い言語は全く触れたことがない若者エンジニア
    - React勉強中です！の人


## やりたい提案手法

- コードベースから最新の詳細設計書を生成する
- コンバーション（COBOL→Javaのように生成）する

### コードベースから最新の詳細設計書を生成

- エンドポイントや機能の動作を、詳細設計などの情報に文字列化

|||
|-|-|
|関数名|hogehoge|
|機能|値の合計を返す|
|引数|数字の配列|
|返り値|数値|
|例外|なし|

- これを全てのファイル、処理で実施
- あるいはテストデータ（Jest）を経由するのもあり

#### 最新の詳細設計書を生成

- 開発者は詳細設計書を用いて新しい言語・フレームワークで開発する
- バックエンドはAPI設計書やDB設計書を生成

### コンバーション

- COBOL→Javaに直接変換する手法
- 比較的似た言語（オブジェクト指向→オブジェクト指向）であれば比較的実現可能性は高い
- 似てない言語（オブジェクト指向→Reactive）は大変
- 変数の引き継ぎや、異なるファイルの読み込み、ライブラリなどの選定までなると完全にAIに置き換えるのは難しそう

## 考えられる手法

- OpenAIを使用した方法
    - ChatGPTやGitHub Copilot
- ただ大規模となると１ファイルごとにOpenAIを使うのは現実的でない
    - マイグレーションに特化した生成AIを独自で作成？
